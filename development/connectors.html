<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Development of connectors · OpenCTI documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Connectors are the cornerstone of the OpenCTI platform and allow organizations to easily ingest new data on the platform. The OpenCTI core development team will provide as many connectors as they can but any developers can contribute to community connectors provided on the [official repository](https://github.com/OpenCTI-Platform/connectors)."/><meta name="docsearch:version" content="1.1.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Development of connectors · OpenCTI documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://opencti-platform.github.io/docs/"/><meta property="og:description" content="Connectors are the cornerstone of the OpenCTI platform and allow organizations to easily ingest new data on the platform. The OpenCTI core development team will provide as many connectors as they can but any developers can contribute to community connectors provided on the [official repository](https://github.com/OpenCTI-Platform/connectors)."/><meta property="og:image" content="https://opencti-platform.github.io/docs/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://opencti-platform.github.io/docs/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/docs/img/logo.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/docs/css/prism.css"/><link rel="stylesheet" href="/docs/css/main.css"/><script src="/docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/"><img class="logo" src="/docs/img/logo_header.png" alt="OpenCTI documentation"/><h2 class="headerTitleWithLogo">OpenCTI documentation</h2></a><a href="/docs/versions"><h3>1.1.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started/introduction" target="_self">Documentation</a></li><li class=""><a href="https://slack.luatix.org" target="_self">Help</a></li><li class=""><a href="https://www.github.com/OpenCTI-Platform/opencti" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Development</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting-started/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/getting-started/architecture">Architecture</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Installation</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/installation/docker">Using Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/installation/manual">Manual deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/installation/connectors">Enable connectors</a></li><li class="navListItem"><a class="navItem" href="/docs/development/installation">Development environment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Usage</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/usage/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/usage/model">Data model</a></li><li class="navListItem"><a class="navItem" href="/docs/usage/reports-create">Create reports</a></li><li class="navListItem"><a class="navItem" href="/docs/usage/report-knowledge">Add knowledge to a report</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/reference/relations">Relations between things</a></li><li class="navListItem"><a class="navItem" href="/docs/reference/inferences">Inferred relations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Development</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/development/connectors">Connectors</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Development of connectors</h1></header><article><div><span><p>Connectors are the cornerstone of the OpenCTI platform and allow organizations to easily ingest new data on the platform. The OpenCTI core development team will provide as many connectors as they can but any developers can contribute to community connectors provided on the <a href="https://github.com/OpenCTI-Platform/connectors">official repository</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>We choose to have a very decentralized approach on connectors, in order to bring a maximum freedom to developers and vendors. So a connector on OpenCTI can be defined by <strong>a standalone Python 3 process that pushes an understandable format of data to an ingestion queue of messages</strong>.</p>
<blockquote>
<p>For the moment, only a valid STIX2 bundle is supported, by we intend to support CSV and other formats in the future.</p>
</blockquote>
<p><img src="/docs/assets/development/connector_architecture.png" alt="Connector architecture" title="Connector architecture"></p>
<p>Each connector must implement a long-running process that can be launched just by executing the main Python file. The only mandatory dependency is the <code>OpenCTIConnectorHelper</code> class that enables the connector to send data to OpenCTI.</p>
<h2><a class="anchor" aria-hidden="true" id="connector-configuration"></a><a href="#connector-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connector configuration</h2>
<p>The connector configuration can be based on a <code>config.yml</code> located in the same directory than the main file or in environments variables when using Docker.</p>
<blockquote>
<p>In the configuration, the RabbitMQ configuration is mandatory, as well as the <code>name</code> and the <code>confidence_level</code> (that will be used to solve conflicts between entities or relationships).</p>
</blockquote>
<p>Here is an example of a simple <code>config.yml</code> file:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">rabbitmq:</span>
<span class="hljs-attr">  hostname:</span> <span class="hljs-string">'localhost'</span>
<span class="hljs-attr">  port:</span> <span class="hljs-number">5672</span>
<span class="hljs-attr">  username:</span> <span class="hljs-string">'guest'</span>
<span class="hljs-attr">  password:</span> <span class="hljs-string">'guest'</span>

<span class="hljs-attr">connector:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">'Connector instance'</span>
<span class="hljs-attr">  confidence_level:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  log_level:</span> <span class="hljs-string">'info'</span>
</code></pre>
<blockquote>
<p>For environement variables, your connector must respect the standard mapping of configuration, replacing each list level by the char <code>_</code>. For instance, the configuration <code>config['connector']['server']['hostname']</code> can be set as an environement variable named <code>CONNECTOR_SERVER_HOSTNAME</code>.</p>
</blockquote>
<pre><code class="hljs css language-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Connector</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Get configuration</span>
        config_file_path = os.path.dirname(os.path.abspath(__file__)) + <span class="hljs-string">'/config.yml'</span>
        self.config = dict()
        <span class="hljs-keyword">if</span> os.path.isfile(config_file_path):
            config = yaml.load(open(config_file_path), Loader=yaml.FullLoader)
            self.config_rabbitmq = config[<span class="hljs-string">'rabbitmq'</span>]
            self.config[<span class="hljs-string">'name'</span>] = config[<span class="hljs-string">'connector'</span>][<span class="hljs-string">'name'</span>]
            self.config[<span class="hljs-string">'confidence_level'</span>] = config[<span class="hljs-string">'connector'</span>][<span class="hljs-string">'confidence_level'</span>]
            self.config[<span class="hljs-string">'log_level'</span>] = config[<span class="hljs-string">'connector'</span>][<span class="hljs-string">'log_level'</span>]
        <span class="hljs-keyword">else</span>:
            self.config_rabbitmq = dict()
            self.config_rabbitmq[<span class="hljs-string">'hostname'</span>] = os.getenv(<span class="hljs-string">'RABBITMQ_HOSTNAME'</span>, <span class="hljs-string">'localhost'</span>)
            self.config_rabbitmq[<span class="hljs-string">'port'</span>] = os.getenv(<span class="hljs-string">'RABBITMQ_PORT'</span>, <span class="hljs-number">5672</span>)
            self.config_rabbitmq[<span class="hljs-string">'username'</span>] = os.getenv(<span class="hljs-string">'RABBITMQ_USERNAME'</span>, <span class="hljs-string">'guest'</span>)
            self.config_rabbitmq[<span class="hljs-string">'password'</span>] = os.getenv(<span class="hljs-string">'RABBITMQ_PASSWORD'</span>, <span class="hljs-string">'guest'</span>)
            self.config[<span class="hljs-string">'name'</span>] = os.getenv(<span class="hljs-string">'CONNECTOR_NAME'</span>, <span class="hljs-string">'Connector instance'</span>)
            self.config[<span class="hljs-string">'confidence_level'</span>] = int(os.getenv(<span class="hljs-string">'CONNECTOR_CONFIDENCE_LEVEL'</span>, <span class="hljs-number">3</span>))
            self.config[<span class="hljs-string">'log_level'</span>] = os.getenv(<span class="hljs-string">'CONNECTOR_LOG_LEVEL'</span>, <span class="hljs-string">'info'</span>)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="initialize-the-opencti-connector-helper"></a><a href="#initialize-the-opencti-connector-helper" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initialize the OpenCTI connector helper</h2>
<p>After getting the configuration parameters of your connector, you have to initialize the OpenCTI connector helper by using the <code>pycti</code> Python library.</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pycti <span class="hljs-keyword">import</span> OpenCTIConnectorHelper

connector_identifier = instance_name <span class="hljs-comment"># where instance_name is lowercase and contains no special chars, unique based</span>
<span class="hljs-comment"># connector_identifier = ''.join(e for e in self.config['name'] if e.isalnum()).lower()</span>

self.opencti_connector_helper = OpenCTIConnectorHelper(
    connector_identifier,
    self.config, <span class="hljs-comment"># the configuration of the connector</span>
    self.config_rabbitmq, <span class="hljs-comment"># the RabbitMQ configuration with hostname, port, username and password</span>
    <span class="hljs-string">'info'</span> <span class="hljs-comment"># info, warning, error</span>
)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="send-data-to-opencti"></a><a href="#send-data-to-opencti" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send data to OpenCTI</h2>
<p>The OpenCTI connector helper method <code>send_stix2_bundle</code> must be used to send data to OpenCTI. Other methods such as <code>send_csv</code> will be implemented in the future. The <code>send_stix2_bundle</code> function takes 2 arguments.</p>
<ol>
<li>A serialized STIX2 bundle as a <code>string</code> (mandatory)</li>
<li>A <code>list</code> of entities types that should be ingested (optional)</li>
</ol>
<p>Here is an example using the STIX2 Python library:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> stix2 <span class="hljs-keyword">import</span> Bundle

bundle = Bundle(objects=bundle_objects).serialize()
self.opencti_connector_helper.send_stix2_bundle(bundle)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h2>
<p>You can read the source code of the OpenCTI connectors directly in the <a href="https://github.com/OpenCTI-Platform/connectors">dedicated repository</a>.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 7/22/2019 by Samuel Hassine</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/reference/inferences"><span class="arrow-prev">← </span><span>Inferred relations</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#connector-configuration">Connector configuration</a></li><li><a href="#initialize-the-opencti-connector-helper">Initialize the OpenCTI connector helper</a></li><li><a href="#send-data-to-opencti">Send data to OpenCTI</a></li><li><a href="#examples">Examples</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/docs/" class="nav-home"><img src="/docs/img/logo.png" alt="OpenCTI documentation" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/installation/docker">Install using Docker</a><a href="/docs/usage/overview">Usage introduction</a><a href="/docs/development/installation">Development environment</a></div><div><h5>Community</h5><a href="https://demo.opencti.io">Demonstration</a><a href="http://stackoverflow.com/questions/tagged/OpenCTI" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://slack.luatix.org/">Slack</a><a href="https://twitter.com/LuatixHQ" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://www.luatix.org/en/blog/">Blog</a><a href="https://github.com/OpenCTI-Platform">GitHub</a><a class="github-button" href="https://github.com/OpenCTI-Platform/opencti" data-icon="octicon-star" data-count-href="/OpenCTI-Platform/opencti/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 OpenCTI</section></footer></div></body></html>